<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeVisit - Expat Housing Assistant</title>
    <script src="https://unpkg.com/@vapi-ai/web"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .call-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .start-btn {
            background: #4CAF50;
            color: white;
        }
        .end-btn {
            background: #f44336;
            color: white;
        }
        .question-btn {
            background: #2196F3;
            color: white;
            margin: 5px;
        }
        .status {
            text-align: center;
            padding: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .transcript, .warnings {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            height: 200px;
            overflow-y: auto;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .landlord {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .tenant {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        .warning {
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .warning.red-flag {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .warning.caution {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
        }
        .warning-icon {
            font-size: 24px;
        }
        .question-buttons {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† HomeVisit Assistant</h1>
            <p>Real-time translation and legal protection for expat housing visits</p>
        </div>

        <div class="call-controls">
            <button class="start-btn" onclick="startCall()">üìû Start Call</button>
            <button class="end-btn" onclick="endCall()">üìû End Call</button>
        </div>

        <div id="status" class="status">Ready to start call</div>

        <div class="transcript">
            <h3>üìù Conversation</h3>
            <div id="transcript-content"></div>
        </div>

        <div class="warnings">
            <h3>‚ö†Ô∏è Legal Warnings</h3>
            <div id="warnings-content"></div>
        </div>

        <div class="question-buttons">
            <h3>üí¨ Ask Questions</h3>
            <button class="question-btn" onclick="askQuestions('general')">General</button>
            <button class="question-btn" onclick="askQuestions('legal')">Legal</button>
            <button class="question-btn" onclick="askQuestions('building')">Building</button>
            <button class="question-btn" onclick="askQuestions('utilities')">Utilities</button>
        </div>
    </div>

    <script>
        // Initialize VAPI
        const vapi = new Vapi("YOUR_VAPI_PUBLIC_KEY");

        // VAPI Event Handlers
        vapi.on("call-start", () => {
            updateStatus("üìû Connected - Speak now!");
            document.getElementById('transcript-content').innerHTML = '';
            document.getElementById('warnings-content').innerHTML = '';
        });

        vapi.on("speech-update", (speech) => {
            if (speech.transcript) {
                displayTranscript(speech.transcript, speech.speaker || 'Unknown');
            }
        });

        vapi.on("message", (message) => {
            console.log("VAPI Message:", message);
            
            // Handle compliance warnings from function calls
            if (message.type === "function-call" && message.functionCall) {
                if (message.functionCall.name === "check_compliance") {
                    const result = message.functionCall.result || {};
                    if (result.warning) {
                        displayWarning(result.warning, result.risk_level || 'caution');
                    }
                }
            }
        });

        vapi.on("call-end", () => {
            updateStatus("üìû Call ended");
        });

        vapi.on("error", (error) => {
            console.error("VAPI Error:", error);
            updateStatus("‚ùå Error: " + error.message);
        });

        // UI Functions
        function startCall() {
            updateStatus("üîÑ Connecting...");
            // Replace with your actual VAPI phone number or assistant ID
            vapi.start("YOUR_VAPI_PHONE_NUMBER");
        }

        function endCall() {
            vapi.stop();
        }

        function displayTranscript(text, speaker) {
            const transcriptDiv = document.getElementById('transcript-content');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${speaker.toLowerCase().replace(' ', '-')}`;
            
            const time = new Date().toLocaleTimeString();
            messageDiv.innerHTML = `
                <small style="color: #666;">${time}</small><br>
                <strong>${speaker}:</strong> ${text}
            `;
            
            transcriptDiv.appendChild(messageDiv);
            transcriptDiv.scrollTop = transcriptDiv.scrollHeight;
        }

        function displayWarning(text, riskLevel) {
            const warningsDiv = document.getElementById('warnings-content');
            const warningDiv = document.createElement('div');
            warningDiv.className = `warning ${riskLevel.toLowerCase().replace(' ', '-')}`;
            
            const icon = riskLevel === 'red flag' ? 'üö®' : '‚ö†Ô∏è';
            warningDiv.innerHTML = `
                <div class="warning-icon">${icon}</div>
                <div class="warning-text">${text}</div>
            `;
            
            warningsDiv.appendChild(warningDiv);
            warningsDiv.scrollTop = warningsDiv.scrollHeight;
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function askQuestions(category) {
            // Trigger VAPI function to ask pre-defined questions
            vapi.sendFunctionCall({
                name: "ask_questions",
                parameters: { category: category }
            });
        }

        // For demo purposes - simulate messages
        function simulateDemo() {
            updateStatus("üé¨ Demo Mode - Simulating conversation");
            
            setTimeout(() => {
                displayTranscript("Die Kaution betr√§gt 6 Monatsmieten.", "Landlord");
                displayWarning("‚ö†Ô∏è WARNING: Maximum 3 months deposit allowed by law!", "red flag");
            }, 1000);
            
            setTimeout(() => {
                displayTranscript("The security deposit is 6 months' rent.", "Translation");
            }, 1500);
        }

        // Add demo button for hackathon
        document.addEventListener('DOMContentLoaded', () => {
            const controls = document.querySelector('.call-controls');
            const demoBtn = document.createElement('button');
            demoBtn.className = 'start-btn';
            demoBtn.textContent = 'üé¨ Run Demo';
            demoBtn.onclick = simulateDemo;
            controls.appendChild(demoBtn);
        });
    </script>
</body>
</html>
